#!/usr/bin/env node
const program = require('caporal');
const boomer = require('../index');

const pkg = require('../package.json');
program.version(pkg.version).description(pkg.description);

program
  .argument('<phone>', '手机号码')
  .option('-f, --forever', '是否持久运行，默认只运行一个周期', program.BOOLEAN, false)
  .option('--dev', '是否是开发模式，如果true，则显示浏览器运行过程', program.BOOLEAN, false)
  .action((argv, opts) => {
    const app = boomer(argv.phone || process.env.PHONE || '13800000000', {
      once: !opts.forever,
      isProduction: !opts.dev
    });

    app
      .on('open', () => {
        console.info(`打开浏览器...`);
      })
      .on('next', (ctx) => {
        console.info(`进入到 ${ctx.currentPage}`);
      })
      .on('error', err => {
        console.error(err);
      })
      // bootstrap
      .emit('bootstrap');
  });

program.parse(process.argv);
